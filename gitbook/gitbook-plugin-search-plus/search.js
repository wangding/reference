require(["gitbook","jquery"],function(r,s){var i,l,u,c,d,h=500,e=r.state,p={},n=void 0!==window.history.pushState,t=s("body");function f(e){if(null!=e&&""!==e.trim()){e=e.toLowerCase();var t,n=[],o=-1;for(t in p){var a=p[t];(~a.keywords.toLowerCase().indexOf(e)||~(o=a.body.toLowerCase().indexOf(e)))&&n.push({url:t,title:a.title,body:a.body.substr(Math.max(0,o-50),h).replace(/^[^\s,.]+./,"").replace(/(..*)[\s,.].*/,"$1").replace(new RegExp("("+String(e).replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")+")","gi"),'<span class="search-highlight-keyword">$1</span>')})}!function(a){i=s("#book-search-results"),l=i.find(".search-results-list"),u=i.find(".search-results-title"),c=u.find(".search-results-count"),d=u.find(".search-query"),i.addClass("open");var e=0==a.count;i.toggleClass("no-results",e),l.empty(),c.text(a.count),d.text(a.query),a.results.forEach(function(e){var t=s("<li>",{class:"search-results-item"}),n=s("<h3>"),o=s("<a>",{href:r.state.basePath+"/"+e.url+"?h="+encodeURIComponent(a.query),text:e.title,"data-is-search":1});o[0].href.split("?")[0]===window.location.href.split("?")[0]&&o[0].setAttribute("data-need-reload",1);e=e.body.trim();e.length>h&&(e+="...");e=s("<p>").html(e);o.appendTo(n),n.appendTo(t),e.appendTo(t),t.appendTo(l)}),s(".body-inner").scrollTop(0)}({count:n.length,query:e,results:n})}}function o(e){var n,o,a;t.addClass("with-search"),t.addClass("search-loading"),n=function(){f(e),t.removeClass("search-loading")},function(){var e=this,t=arguments;a=a||setTimeout(function(){a=null,n.apply(e,t)},o)}()}function a(){t.removeClass("with-search"),s("#book-search-results").removeClass("open")}function g(){var e=s("body");e.on("keyup","#book-search-input input",function(e){var t;13===e.keyCode&&n&&(t=b("q",s(this).val()),window.history.pushState({path:t},null,t)),0===(t=s("#book-search-input input").val()).length?a():o(t)}),e.on("blur","#book-search-input input",function(e){var t;n&&(t=b("q",s(this).val()),window.history.pushState({path:t},null,t))})}r.events.on("start",function(){g(),s.getJSON(e.basePath+"/search_plus_index.json").then(function(e){p=e,w(),a()})});var v=function(e){s(".page-inner").mark(e,{ignoreJoiners:!0,acrossElements:!0,separateWordSearch:!1}),setTimeout(function(){var e=s('mark[data-markjs="true"]');e.length&&e[0].scrollIntoView()},100)};function w(){var e,t;/\b(q|h)=([^&]+)/.test(window.location.search)&&(t=RegExp.$1,e=decodeURIComponent(RegExp.$2),("q"===t?o:v)(e),s("#book-search-input input").val(e))}function b(e,t){t=encodeURIComponent(t);var n=window.location.href.replace(/([?&])(?:q|h)=([^&]+)(&|$)/,function(e,t,n,o){return"&"===o?t:""}),o=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(o.test(n))return null!=t?n.replace(o,"$1"+e+"="+t+"$2$3"):(n=(a=n.split("#"))[0].replace(o,"$1$3").replace(/(&|\?)$/,""),void 0!==a[1]&&null!==a[1]&&(n+="#"+a[1]),n);if(null==t)return n;var a,o=-1!==n.indexOf("?")?"&":"?",n=(a=n.split("#"))[0]+o+e+"="+t;return void 0!==a[1]&&null!==a[1]&&(n+="#"+a[1]),n}r.events.on("page.change",w),window.addEventListener("click",function(e){"A"===e.target.tagName&&e.target.getAttribute("data-need-reload")&&setTimeout(function(){window.location.reload()},100)},!0)});